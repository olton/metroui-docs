---
title: Model
---

import Leader from '../../../components/Leader.astro'
import { Tabs, TabItem, Badge } from '@astrojs/starlight/components';
import GithubButton from '../../../components/GithubButton.astro';

<div>
    <GithubButton user="olton" repo="model"/>
</div> 

<Leader content="Metro UI includes class Model to create reactive two-way binding."/>

## About

Model is a reactive model for JavaScript applications. 
This class provides a simple way to create reactive properties and methods, allowing you to build dynamic and interactive applications.

:::tip
To access to a reactive model in Metro UI, use global class `Model`.
:::

## Installation
Metro UI already includes the `Model` library.
You can use it without any additional installation, but if you want to use it in your project, you can install it with package manager:

<Tabs>
    <TabItem label="npm" icon="seti:npm">
        ```bash
        npm install @olton/model
        ```
    </TabItem>
    <TabItem label="pnpm" icon="pnpm">
        ```bash
        pnpm install @olton/model
        ```
    </TabItem>
    <TabItem label="yarm" icon="seti:yarn">
        ```bash
        yarn add @olton/model
        ```
    </TabItem>
</Tabs>

or use CDN:

```html
<script src="https://esm.run/@olton/model"></script>
```

## Usage

```html title="index.html"
<div id="root">
    <div>{{ name }}</div>
    <div>{{ age }}</div>
</div>  
```

```js title="index.js"
import { Model } from "@olton/model";

const model = new Model({
    name: "John",
    age: 30
});

model.init("#root");

model.data.name = "Mike";
model.data.age = 31;
```

## Binding

You can bind model to HTML elements.

```html
<div>{{ age }}</div>
<input type="text" data-model="name">
```

```js
const model = new Model({
    name: "John",
    age: 30
});
```

## Loops (data-for)
You can use model in loops.

```html
<ul>
    <li data-for="item in items">{{ item }}</li>
</ul>
```

```js
const model = new Model({
    items: ["Item 1", "Item 2", "Item 3"]
});
```

## Conditionals (data-if)
You can use conditionals in a model. In example below, if `isVisible` is true, the div will be rendered.

```html
<div data-if="isVisible">Hello</div>
```

```js
const model = new Model({
    isVisible: true
});
```

## Nested objects
You can use nested objects in model.

```html
<div>{{ user.name }}</div>
```

```js
const model = new Model({
    user: {
        name: "John",
        age: 30
    }
});
```

## Arrays
You can use arrays in model.

```html
<ul>
    <li data-for="item in items">{{ item }}</li>
</ul>
```

```js   
const model = new Model({
    items: ["Item 1", "Item 2", "Item 3"]
});
```

#### applyArrayChanges()

You can use `applyArrayChanges` method to apply changes to array.

```js
model.applyArrayChanges('users', (users) => users.push({ name: 'John Dow' }));
```

## Calculated properties
You can use calculated properties in model.

```html
<div>{{ fullName }}</div>
```

```js
const model = new Model({
    firstName: "John",
    lastName: "Doe",
    fullName() {
        return this.firstName + " " + this.lastName;
    }
});
```

## Middleware
You can use middleware in a model.

```js
const model = new Model({
    name: "John",
    age: 30,
    counter: 10,
});

model.use(async (context, next) => {
     if (context.property === 'counter' && context.newValue < 0) {
         context.preventDefault = true;
         return;
     }
     await next();
});
```

## Events
You can use events in a model.

```js
const model = new Model({
    name: "John",
    age: 30,
});

model.on("change", (property, newValue, oldValue) => {
    console.log(`Property ${property} changed from ${oldValue} to ${newValue}`);
});
```

You can use next events in model:

- `init` - when model initialized
- `change` - when property changed
- `batchComplete` - when batch complete
- `compute` - when computed property changed
- `saveState` - when model state saved
- `loadState` - when model state loaded
- `restoreState` - when model state restored
- `restoreStateError` - when model state restored with error

## Watchers
You can use watchers in model.

```js   
const model = new Model({
    name: "John",
    age: 30,
});

model.watch("name", (newValue, oldValue) => {
    console.log(`Name changed from ${oldValue} to ${newValue}`);
});
```

## Validation
You can add validators to the model to validate user input.

```js
const model = new Model({
    name: "John",
    age: 30,
});

model.addValidator('name', value => value.length >= 3);
```

## Formatting
You can add formatters to the model to format user input.

```js
const model = new Model({
    name: "John",
    age: 30,
});

model.addFormatter('name', value => value.toUpperCase());
```

## State
You can save and restore model state from localstorage.

### Load state

```js
var model

document.addEventListener('DOMContentLoaded', () => {
    model = new Metro.Model(null, {
        id: 'model-state'
    });

   model.loadState()
   model.init("#root")
})
```

### Save state

```js
window.addEventListener('beforeunload', () => {
     model.saveState();
})
```

### Auto save state

```js
const model = new Model();

model.enableAutoSave(5000); // save every 5 seconds
```

### Disable auto save state

```js
model.disableAutoSave();
```

## Batch updates
You can use batch updates in model. Batch updates are useful when you want to update multiple properties at once without triggering the change event for each property.

```js
const model = new Model({
    name: "John",
    age: 30,
});

model.batch(() => {
    model.data.name = "Mike";
    model.data.age = 31;
});
```

## DevTools

You can activate DevTools for a model. DevTools is useful when you want to debug your model.

```js
const model = new Model({});

const devTools = model.initDevTools({
    enabled: true,
    timeTravel: true,
    maxSnapshots: 50
});
```

## Validating Model

To validate model, you can use methods:

+ `validateModel()` - validate model for cycling dependencies and missing properties
+ `isValidPath(path)` - check if path is valid

```js
const model = new Model({
    name: "John",
    age: 30,
});

model.validateModel();
model.isValidPath('name'); // true
model.isValidPath('lastname'); // false
```